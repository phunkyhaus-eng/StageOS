{
  "family": "stageos-worker",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "512",
  "memory": "1024",
  "executionRoleArn": "arn:aws:iam::123456789012:role/stageos-ecs-task-exec",
  "taskRoleArn": "arn:aws:iam::123456789012:role/stageos-worker-task",
  "containerDefinitions": [
    {
      "name": "stageos-worker",
      "image": "ghcr.io/ORG/REPO/stageos-api:production",
      "essential": true,
      "command": ["node", "dist/apps/api/src/worker.js"],
      "environment": [
        { "name": "NODE_ENV", "value": "production" },
        { "name": "QUEUE_PROCESSOR_ENABLED", "value": "true" },
        { "name": "QUEUE_WEBHOOK_CONCURRENCY", "value": "10" },
        { "name": "JWT_ISSUER", "value": "stageos" },
        { "name": "COOKIE_SECURE", "value": "true" },
        { "name": "S3_BUCKET", "value": "stageos-assets" },
        { "name": "S3_FORCE_PATH_STYLE", "value": "false" },
        { "name": "FILE_MAX_BYTES", "value": "26214400" },
        { "name": "RATE_LIMIT_TTL_SECONDS", "value": "60" },
        { "name": "RATE_LIMIT_PER_MINUTE", "value": "120" },
        { "name": "DEFAULT_RETENTION_DAYS", "value": "90" },
        { "name": "GRACE_PERIOD_DAYS", "value": "7" },
        { "name": "MOBILE_APP_SCHEME", "value": "stageos://" }
      ],
      "secrets": [
        { "name": "APP_URL", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/app_url" },
        { "name": "API_BASE_URL", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/api_base_url" },
        { "name": "DATABASE_URL", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/database_url" },
        { "name": "READ_DATABASE_URL", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/read_database_url" },
        { "name": "REDIS_URL", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/redis_url" },
        { "name": "JWT_ACCESS_SECRET", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/jwt_access_secret" },
        { "name": "JWT_REFRESH_SECRET", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/jwt_refresh_secret" },
        { "name": "ENCRYPTION_KEY", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/encryption_key" },
        { "name": "S3_ENDPOINT", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/s3_endpoint" },
        { "name": "S3_PUBLIC_ENDPOINT", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/s3_public_endpoint" },
        { "name": "S3_REGION", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/s3_region" },
        { "name": "S3_ACCESS_KEY", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/s3_access_key" },
        { "name": "S3_SECRET_KEY", "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:stageos/s3_secret_key" }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/stageos-worker",
          "awslogs-region": "us-east-1",
          "awslogs-stream-prefix": "ecs"
        }
      }
    }
  ]
}
